/feature 需求如下:

项目背景:
核心逻辑：从“静态阻力”到“动态战场”
传统的技术分析可能只看K线和成交量，而您的数据允许您看到市场最真实的“骨架”和“血流”。

深度快照：告诉您在任意时刻，市场上有多少未成交的买卖意愿。这就像一张战场静态地图，标明了敌我双方的兵力部署（挂单墙）。

订单流数据：告诉您这些兵力是如何被消耗、补充和移动的。它记录了每一笔交易是在哪个价位、吃掉了多少量的买单或卖单，以及是否有新的挂单进入。这就像是战场的实时动态录像。

结合两者，您就能从“哪里有关口”升级到“哪个关口最近战斗最激烈、最难被攻破、且反复被争夺”。

具体分析步骤与寻找“高价值区域”
我们可以将分析分为三个层次：静态层次、动态层次和合成决策。

层次一：基于深度快照的静态支撑/阻力分析
识别巨量挂单墙：

在5000层深度中，寻找挂单量显著高于周围平均水平的价位。这些是强大的静态阻力位。

做市逻辑：将流动性放在大单的同一侧但略微靠前的位置。例如，如果$50.00有1000 BTC的卖单墙，您可以将卖单放在$49.99。这样，当市场上涨触及卖单墙时，您的订单会先于大单成交。如果大单被吃掉，市场动能可能衰竭，您已获利了结；如果大单未被吃掉，您也获得了更优的成交位置。

识别高密度挂单区：

寻找挂单量持续处于高位的价格区间，而不是单个价位。这代表了一个宽阔的支撑/阻力带。

做市逻辑：在这个区间内，您可以分散部署您的流动性，形成一个“薄而宽”的流动性供应带，以提高命中率。

层次二：基于订单流数据的动态确认（这是关键！）
静态数据可能会“骗人”，大单可能被瞬间撤走（幽灵单）。订单流数据可以帮您验证这些区域的真实性。

识别高成交量节点/控制点：

将3天的订单流数据按价格区间进行汇总，找出成交量最集中的价格水平。这些POC是市场在过去3天达成共识的价值区域，资产价格有强烈的倾向回到这些区域。

做市逻辑：POC区域是部署流动性的首选。在这些价位附近，买卖活动会非常频繁，为您的挂单提供了极高的成交概率。

识别有效支撑/阻力：

观察在静态分析找到的“挂单墙”或“高密度区”附近，订单流数据是否显示：

大量吃单行为：价格接近该区域时，是否出现大额的Market Buy或Market Sell单子，但价格未能有效突破？这证明了该区域的强度。

吸收与拒绝：当卖单流（Selling Pressure）冲击一个支撑位时，是否被迅速吸收且价格反弹？当买单流（Buying Pressure）冲击一个阻力位时，是否被拒绝且价格回落？

做市逻辑：在被反复验证有效的支撑位下方部署买单，在阻力位上方部署卖单。这些是“高概率反弹”的区域。

识别流动性“真空区”：

观察深度快照中挂单量非常稀薄的区域。订单流数据会显示，当价格进入这些区域时，往往会出现快速的滑移。

做市逻辑：避免在真空区的中心挂单，因为成交后价格可能瞬间远离，使您的头寸立即处于不利位置。但可以在真空区的边缘，靠近下一个高密度挂单区的地方挂单，以捕捉价格“撞击”到下一个密集区时的反弹。

层次三：合成决策与策略优化
寻找“共振区域”：

将以上分析叠加，寻找静态挂单密集区、动态POC、以及被订单流验证有效的关键价位三者重合的区域。这些是市场中多重力量汇聚的点，是流动性部署的“兵家必争之地”。

示例：$100.00既是5000层深度中的巨量卖单墙，又是过去3天订单流的POC，同时订单流显示昨天有三次价格冲击$100.00都被坚决地打了回来。那么，$100.00就是一个完美的共振阻力区域。

确定挂单范围与仓位管理：

您不需要精确地挂在一个点上。可以在共振区域上下一个很小的范围内（例如±0.05%）设置多个挂单。

根据该区域的强度（挂单量、订单流吸收量）来分配仓位。强度越高的区域，可以部署的流动性比例越高。
这个项目分为三个anget来对应三个层次

项目分为两个进程:

1- agent_data_collector.py  负责收集市场数据并缓存到本地redis的进程入口文件

2- agent_analyzer.py        负责读取redis缓存内的数据做数据分析的进程入口文件

agent_data_collector进程:

初始化:

快照数据获取: 系统启动的时候进行初始化的时候获取5000层深度快照
5000层快照使用的api: https://api.binance.com/api/v3/depth?symbol=BTCFDUSD&limit=5000
并缓存到redis中 key使用 depth_snapshot_5000

订单流数据：

主要依赖trade逐笔订单事件 因为binance官方不提供获取历史的trades数据集
所以需要在进程中自建一个websocket连接线程来增量采集 缓存最近48h的trades数据：
wss://stream.binance.com:9443/ws/btcfdusd@aggTrade
可以参照binance developer docs api来找到具体怎么做 读取trade事件理解每个参数的含义 并将每分钟聚合数据点 缓存到本地的window=48*60长度的按照时间顺序的数组中
trades每分钟内部的聚合数据细节为:
按照每个价格精度1美元
按照不同价格整数层级 110000, 110001, 110002, 110003 ... 聚合保存，比如 出现了5个trade: side: buy 110000.25@0.001, side: buy 110000.01@0.06, side: sell 110000.9@0.05, side: buy 110001@0.03, side: sell 110001@0.001 ... 

那么聚合后的1分钟内的数据点的数据就是:
110000 -> buy_vol: 0.001+0.06
          sell_vol: 0.05
          total_vol: 0.12
          delta: 0.02
110001 -> buy_vol: 0.03
          sell_vol: 0.001
          total: 0.04
          delta: 0.02
...

然后将每个1分钟的聚合数据点按照时间顺序保存到redis key=trades_window 中缓存 滑动窗口长度为48*60

运行阶段:

深度快照数据按照每分钟调用一次rest api获取一次新的并插入到redis的滑动窗口里 到redis的depth_snapshot_5000  保留最近60个滑动窗口长度

trades 的获取：
通过创建一个websocket连接的线程去连接市场数据websocket: wss://stream.binance.com:9443/ws/btcfdusd@aggTrade
将实时推送数据按照前面的要求处理和缓存即可。注意 通过官方开发文档说明保证websocket生命周期管理。


进程退出: 直接关闭websocket连接




agent_analyzer进程:
此进程用于做数据分析并给出大模型（deepseek）的分析结论。
分为三个function call tool 函数用于给大模型使用。

tool: depth_snapshot_analytsis()  基于深度快照的静态支撑/阻力分析

tool: orderflow_analysys() 基于订单流数据的分析函数  



当每分钟触发分析流程，告诉deepseek分析流程，第一步先告诉deepseek我们要做深度快照分析支撑阻力寻找可以做市的关键热点，第二步做订单流数据分析确认动态数据和静态数据的共振区域 然后把两个tool也放到request请求中具体使用参照deepseek官方的开发文档: https://api-docs.deepseek.com/zh-cn/guides/function_calling

执行完tool之后得到两个tool的分析结果，再把结果打包成一个template 一起提供给ai 基于数据做决策给出spot: btcfdusd现货具体的做市点位区间

然后将结果先临时写入到本地的日志文件中（在项目还没稳定之前做调试使用）。
